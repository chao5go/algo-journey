"""
LeetCode 36. 有效的数独
题目：判断一个 9x9 的数独是否有效
难度：中等

只要根据以下规则，验证已经填入的数字是否有效即可：
1. 数字 1-9 在每一行只能出现一次
2. 数字 1-9 在每一列只能出现一次
3. 数字 1-9 在每一个以粗实线分隔的 3x3 宫内只能出现一次

注意：
- 一个有效的数独（部分已被填充）不一定是可解的
- 只需要根据以上规则，验证已经填入的数字是否有效即可
- 空白格用 '.' 表示

时间复杂度：O(81) = O(1)
空间复杂度：O(27) = O(1)
"""

from typing import List


def is_valid_sudoku(board: List[List[str]]) -> bool:
    """
    判断一个9x9的数独是否有效

    Args:
        board: 9x9的二维字符数组，包含数字1-9或者'.'

    Returns:
        bool: 如果数独有效返回True，否则返回False
    """
    # 使用集合来记录每一行、每一列、每一个3x3宫格中已经出现的数字
    rows = [set() for _ in range(9)]
    cols = [set() for _ in range(9)]
    boxes = [set() for _ in range(9)]  # 3x3宫格，从左到右，从上到下编号为0-8

    for i in range(9):
        for j in range(9):
            num = board[i][j]

            # 如果是空格，跳过
            if num == '.':
                continue

            # 检查当前数字是否在当前行已经出现过
            if num in rows[i]:
                print(f"错误：数字 {num} 在第 {i+1} 行重复出现")
                return False
            rows[i].add(num)

            # 检查当前数字是否在当前列已经出现过
            if num in cols[j]:
                print(f"错误：数字 {num} 在第 {j+1} 列重复出现")
                return False
            cols[j].add(num)

            # 计算当前格子属于哪个3x3宫格
            box_index = (i // 3) * 3 + (j // 3)

            # 检查当前数字是否在当前3x3宫格中已经出现过
            if num in boxes[box_index]:
                print(f"错误：数字 {num} 在第 {box_index+1} 个3x3宫格中重复出现")
                return False
            boxes[box_index].add(num)

    return True


def print_board(board: List[List[str]]) -> None:
    """打印数独棋盘"""
    print("数独棋盘：")
    for i in range(9):
        row_str = ""
        for j in range(9):
            row_str += board[i][j] + " "
            # 每3列添加分隔符
            if j % 3 == 2 and j != 8:
                row_str += "| "
        print(row_str)
        # 每3行添加分隔线
        if i % 3 == 2 and i != 8:
            print("-" * 21)
    print()


def test_solution():
    """测试解决方案"""
    print("=== 测试用例1：有效的数独 ===")
    board1 = [
        ["5","3",".",".","7",".",".",".","."],
        ["6",".",".","1","9","5",".",".","."],
        [".","9","8",".",".",".",".","6","."],
        ["8",".",".",".","6",".",".",".","3"],
        ["4",".",".","8",".","3",".",".","1"],
        ["7",".",".",".","2",".",".",".","6"],
        [".","6",".",".",".",".","2","8","."],
        [".",".",".","4","1","9",".",".","5"],
        [".",".",".",".","8",".",".","7","9"]
    ]

    print_board(board1)
    result1 = is_valid_sudoku(board1)
    print(f"结果：{'有效' if result1 else '无效'}")
    print(f"期望：有效")
    print(f"测试结果：{'✓' if result1 == True else '✗'}")
    print()

    print("=== 测试用例2：无效的数独 ===")
    board2 = [
        ["8","3",".",".","7",".",".",".","."],
        ["6",".",".","1","9","5",".",".","."],
        [".","9","8",".",".",".",".","6","."],
        ["8",".",".",".","6",".",".",".","3"],
        ["4",".",".","8",".","3",".",".","1"],
        ["7",".",".",".","2",".",".",".","6"],
        [".","6",".",".",".",".","2","8","."],
        [".",".",".","4","1","9",".",".","5"],
        [".",".",".",".","8",".",".","7","9"]
    ]

    print_board(board2)
    result2 = is_valid_sudoku(board2)
    print(f"结果：{'有效' if result2 else '无效'}")
    print(f"期望：无效")
    print(f"测试结果：{'✓' if result2 == False else '✗'}")
    print()

    print("=== 测试用例3：行中有重复数字 ===")
    board3 = [
        ["5","5",".",".","7",".",".",".","."],  # 第一行有两个5
        ["6",".",".","1","9","5",".",".","."],
        [".","9","8",".",".",".",".","6","."],
        ["8",".",".",".","6",".",".",".","3"],
        ["4",".",".","8",".","3",".",".","1"],
        ["7",".",".",".","2",".",".",".","6"],
        [".","6",".",".",".",".","2","8","."],
        [".",".",".","4","1","9",".",".","5"],
        [".",".",".",".","8",".",".","7","9"]
    ]

    print_board(board3)
    result3 = is_valid_sudoku(board3)
    print(f"结果：{'有效' if result3 else '无效'}")
    print(f"期望：无效")
    print(f"测试结果：{'✓' if result3 == False else '✗'}")
    print()


def explain_solution():
    """解释解决思路"""
    print("解题思路：")
    print("1. 使用三个数组来分别记录每一行、每一列、每一个3x3宫格中已经出现的数字")
    print("2. 遍历整个9x9棋盘的每个格子")
    print("3. 对于每个非空格子，检查其数字是否在对应行、列、宫格中出现过")
    print("4. 如果任何检查失败，数独无效")
    print("5. 如果遍历完所有格子都没有冲突，数独有效")
    print()
    print("数据结构：")
    print("- rows: 9个集合，分别记录每一行已出现的数字")
    print("- cols: 9个集合，分别记录每一列已出现的数字")
    print("- boxes: 9个集合，分别记录每个3x3宫格已出现的数字")
    print()
    print("宫格编号规则：")
    print("- box_index = (row // 3) * 3 + (col // 3)")
    print("- 左上角宫格编号为0，右下角宫格编号为8")
    print()
    print("时间复杂度：O(81) = O(1)，因为棋盘大小固定")
    print("空间复杂度：O(27) = O(1)")


if __name__ == "__main__":
    print("=== LeetCode 36. 有效的数独 ===")
    print()

    explain_solution()
    print()

    test_solution()